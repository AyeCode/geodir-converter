!function(t,e){"use strict";function n(n,i,r,o){o=void 0!==o?o:{},r=void 0!==r?r:{};const s=e.nonces.hasOwnProperty(n)?e.nonces[n]:"";return r instanceof FormData?(r.append("action",n),r.append("geodir_converter_nonce",s),o.processData=!1,o.contentType=!1):(r.action=n,r.geodir_converter_nonce=s),o=t.extend(o,{url:e.ajaxUrl,dataType:"json",data:r,success:function(t){const e=!0===t.success,n=t.data||{};i(e,n)}}),t.ajax(o)}e.ControlButton={inSuspended:!1,wasDisabled:!1,defaultText:"",actionText:"",ajaxAction:"",converter:null,init:function(t,e){return this.element=t,this.defaultText=e.defaultText,this.actionText=e.actionText,this.ajaxAction=e.ajaxAction,this.converter=e.converter,this.element.on("click",this.click.bind(this)),this},click:function(){if(this.inSuspended)return!1;this.doAction()},doAction:function(){},activate:function(){this.inSuspended=!0,this.element.prop("disabled",!0),this.element.text(this.actionText)},enable:function(){this.inSuspended=!1,this.element.prop("disabled",!1),this.element.text(this.defaultText)},disable:function(){this.inSuspended=!1,this.element.prop("disabled",!0),this.element.text(this.defaultText)},suspend:function(){this.inSuspended=!0,this.wasDisabled=!!this.element.prop("disabled"),this.element.prop("disabled",!0)},restore:function(){this.inSuspended=!1,this.element.prop("disabled",this.wasDisabled)}},e.ImportButton=t.extend({},e.ControlButton,{doAction:function(){const t=this.converter.importerId,e=this.converter.settings.find("form"),i=e.serializeObject(),r=this.converter.errorHandler,o=this;t&&(i.test_mode=e.find("#test_mode").is(":checked")?"yes":"no",this.activate(),r.hide(),n(o.ajaxAction,(function(t,e){t?o.converter.start():(o.enable(),o.converter.stop(),r.show(e.message))}),{importerId:t,settings:i},{method:"POST"}))}}),e.ConfigureButton=t.extend({},e.ControlButton,{activate:function(){this.element.addClass("btn-translucent-success").removeClass("btn-outline-primary").text(this.actionText)},enable:function(){this.element.addClass("btn-outline-primary").removeClass("btn-translucent-success").text(this.defaultText)},doAction:function(){const n=t(".geodir-converter-wrapper"),i=this.converter.element,r=this.converter.settings;n.find(".card-header h6").text(e.i18n.importSource),n.find(".geodir-converter-importer").not(i).addClass("d-none"),t(".geodir-converter-settings").not(r).addClass("d-none"),this.element.addClass("d-none"),this.converter.backButton.element.removeClass("d-none"),i.addClass("border-bottom-0"),r.removeClass("d-none")}}),e.BackButton=t.extend({},e.ControlButton,{doAction:function(){const n=t(".geodir-converter-wrapper"),i=this.converter.element,r=this.converter.settings;this.element.addClass("d-none"),this.converter.configureButton.element.removeClass("d-none"),i.removeClass("border-bottom-0"),r.addClass("d-none"),n.find(".card-header h6").text(e.i18n.selectImport),n.find(".geodir-converter-importer").removeClass("d-none"),r.find("form").length&&(r.find("form")[0].reset(),this.converter.errorHandler.clear())}}),e.AbortButton=t.extend({},e.ControlButton,{doAction:function(){this.activate(),this.converter.stop();const t=this.converter.importerId,e=this;n(e.ajaxAction,(function(t,n){e.converter.start(),t||e.enable()}),{importerId:t},{method:"POST"})}}),e.LogsHandler=t.extend({},{shown:0,init:function(t){return this.element=t,this},insertLogs:function(t){this.element.append(t)},setShown:function(t){this.shown=t},clear:function(){this.shown=0,this.element.html("")}}),e.ErrorHandler={init:function(t){return this.element=t,this},show:function(t){this.element.html(t).removeClass("d-none")},hide:function(){this.element.html("").addClass("d-none")},clear:function(){this.hide()},isVisible:function(){return!this.element.hasClass("d-none")}},e.ProgressBar=t.extend({},{barEl:null,init:function(t){return this.element=t,this.barEl=this.element.find(".progress-bar"),this},updateProgress:function(t){this.element.removeClass("d-none"),this.barEl.css("width",t+"%").text(t+"%")}}),e.Converter={tickInterval:2e3,shortTickInterval:400,retriesCount:1,retriesLeft:0,inProgress:!1,updateTimeout:null,preventUpdates:!1,importerId:null,init:function(n,i){this.element=n,this.inProgress=i.inProgress,this.resetRetries(),this.importerId=this.element.data("importer"),this.settings=this.element.find(".geodir-converter-settings");let r=t.extend({},e.ProgressBar);this.progressBar=r.init(this.element.find(".geodir-converter-progress"));let o=t.extend({},e.LogsHandler);this.logsHandler=o.init(this.element.find(".geodir-converter-logs"));let s=t.extend({},e.ConfigureButton);this.configureButton=s.init(this.element.find(".geodir-converter-configure"),{defaultText:e.i18n.runConverter,actionText:e.i18n.importing,converter:this});let a=t.extend({},e.BackButton);this.backButton=a.init(this.element.find(".geodir-converter-back"),{converter:this});let d=t.extend({},e.ImportButton);this.importButton=d.init(this.element.find(".geodir-converter-import"),{defaultText:e.i18n.import,actionText:e.i18n.importing,ajaxAction:e.actions.import,converter:this});let c=t.extend({},e.AbortButton);this.abortButton=c.init(this.element.find(".geodir-converter-abort"),{defaultText:e.i18n.abort,actionText:e.i18n.aborting,ajaxAction:e.actions.abort,converter:this});let l=t.extend({},e.ErrorHandler);return this.errorHandler=l.init(this.element.find(".geodir-converter-error"),{converter:this}),this.inProgress&&this.start(),this},start:function(){this.preventUpdates=!1,this.logsHandler.clear(),this.updateTimeout=setTimeout(this.tick.bind(this),this.shortTickInterval)},stop:function(){clearTimeout(this.updateTimeout),this.preventUpdates=!0},resetRetries:function(){this.retriesLeft=this.retriesCount},tick:function(){const t=this;n(e.actions.progress,(function(e,n){t.preventUpdates||(e?(t.resetRetries(),n.inProgress?t.markInProgress():t.markStopped(),n.inProgress?t.configureButton.activate():t.configureButton.enable(),t.progressBar.updateProgress(n.progress),t.logsHandler.setShown(n.logsShown),t.logsHandler.insertLogs(n.logs),t.inProgress?t.updateTimeout=setTimeout(t.tick.bind(t),t.tickInterval):(t.abortButton.disable(),t.importButton.enable())):t.retriesLeft>0?(t.retriesLeft--,t.updateTimeout=setTimeout(t.tick.bind(t),t.tickInterval)):t.abortButton.disable())}),{logsShown:t.logsHandler.shown,importerId:this.importerId})},markInProgress:function(){this.inProgress=!0,this.importButton.activate(),this.abortButton.enable()},markStopped:function(){this.inProgress=!1,this.importButton.enable(),this.abortButton.disable()}},t((function(){t(".geodir-converter-importer").each((function(){t.extend({},e.Converter).init(t(this),{inProgress:Boolean(t(this).data("progress"))})}))})),t.fn.serializeObject=function(){var e={},n=this.serializeArray();return t.each(n,(function(){e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""})),e}}(jQuery,GeoDir_Converter);